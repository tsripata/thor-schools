<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ตารางเปรียบเทียบโรงเรียน (โซนพุทธมณฑลสาย 2)</title>
<style>
  :root{
    --bg:#0b1220; --panel:#111a2b; --muted:#9fb0c7; --text:#e8eef6; --brand:#5bd1ff; --accent:#85f089; --chip:#1a2740; --chip2:#0f1b30; --warn:#ffd166;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;background:linear-gradient(180deg,var(--bg),#0a1326 40%, #091021);color:var(--text);font:16px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Inter,Helvetica,Arial}
  a{color:var(--brand);text-decoration:none}
  .wrap{max-width:1200px;margin:auto;padding:24px}
  header{display:flex;gap:16px;align-items:center;flex-wrap:wrap}
  header h1{font-size:clamp(20px,3vw,28px);margin:0}
  .panel{background:rgba(255,255,255,0.03);backdrop-filter: blur(8px);border:1px solid rgba(255,255,255,0.07);border-radius:14px}
  .filters{display:grid;grid-template-columns:repeat(12,1fr);gap:12px;padding:16px}
  .filters > *{grid-column:span 12}
  @media(min-width:720px){.filters > .col-4{grid-column:span 4}}
  @media(min-width:720px){.filters > .col-3{grid-column:span 3}}
  input,select,button{width:100%;padding:10px 12px;border-radius:10px;border:1px solid rgba(255,255,255,0.1);background:rgba(255,255,255,0.05);color:var(--text)}
  input::placeholder{color:#9bb}
  button{cursor:pointer}
  .chips{display:flex;flex-wrap:wrap;gap:6px}
  .chip{padding:6px 10px;border-radius:999px;background:var(--chip);border:1px solid rgba(255,255,255,0.08);font-size:12px;color:#cfe3ff}
  .list{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:14px;margin-top:14px}
  .card{position:relative;padding:14px;display:flex;flex-direction:column;gap:10px}
  .title{font-weight:700;display:flex;align-items:center;gap:12px}
  .meta{display:flex;gap:10px;flex-wrap:wrap;color:var(--muted);font-size:13px}
  .badges{display:flex;gap:6px;flex-wrap:wrap}
  .badge{font-size:11px;padding:4px 8px;border-radius:999px;background:var(--chip2);border:1px solid rgba(255,255,255,0.06)}
  .proscons{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  .proscons ul{margin:0 0 0 18px}
  .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  .pill{padding:4px 8px;border-radius:8px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.08);font-size:12px}
  .soft{color:var(--muted)}
  .warn{color:#2b2b2b;background:var(--warn)}
  footer{opacity:.7;margin:20px 0 80px;font-size:13px}
  .ghost{border:1px dashed rgba(255,255,255,0.12)}
  /* โลโก้ */
  .logo{width:40px;height:40px;border-radius:10px;background:#0f1b30;border:1px solid rgba(255,255,255,0.1);display:grid;place-items:center;overflow:hidden}
  .logo img{display:block;width:100%;height:100%;object-fit:contain;background:#fff}
  .logo .initial{font-weight:800;color:#17223a}
  .logoBar{margin-left:auto;display:flex;gap:8px}
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <div style="flex:1 1 auto">
        <h1>เปรียบเทียบโรงเรียน (จุดอ้างอิง: โซนพุทธมณฑลสาย 2)</h1>
        <div class="soft">ภาษา: ไทย • อัปเดต: ส.ค. 2568 • ไม่มีข้อมูลส่วนบุคคลระบุที่อยู่</div>
      </div>
      <div class="row">
        <button id="btnReset" title="ล้างตัวกรอง" class="pill ghost">ล้างตัวกรอง</button>
        <button id="btnExport" class="pill">ดาวน์โหลด CSV</button>
      </div>
    </header>

    <section class="panel filters" aria-label="ตัวกรองและการค้นหา">
      <input id="q" placeholder="ค้นหา: ชื่อโรงเรียน / หมวด / หลักสูตร / หมายเหตุค่าเทอม" class="col-4" />
      <select id="system" class="col-3" title="ระบบการสอน">
        <option value="">ระบบการสอน — ทั้งหมด</option>
        <option>อังกฤษ</option>
        <option>สิงคโปร์</option>
        <option>อเมริกัน</option>
        <option>สองภาษา</option>
        <option>ทางเลือก</option>
      </select>
      <select id="sort" class="col-3" title="เรียงลำดับ">
        <option value="name">เรียงตามชื่อ</option>
        <option value="normal">เวลาเดินทางปกติ (นาที)</option>
        <option value="peak8">เวลา 08:00 (นาที)</option>
        <option value="peak15">เวลา 15:00 (นาที)</option>
        <option value="distance">ระยะทาง (กม.)</option>
      </select>
      <div class="row col-4">
        <label class="soft" style="min-width:140px">ระยะทางสูงสุด (กม.)</label>
        <input id="maxKm" type="range" min="0" max="35" value="35" style="flex:1"/>
        <div id="maxKmVal" class="pill">≤ 35 กม.</div>
      </div>
      <div class="chips col-12" id="quick">
        <span class="chip" data-sys="ทางเลือก">#ทางเลือก</span>
        <span class="chip" data-sys="อังกฤษ">#อังกฤษ</span>
        <span class="chip" data-sys="สิงคโปร์">#สิงคโปร์</span>
        <span class="chip" data-sys="อเมริกัน">#อเมริกัน</span>
        <span class="chip" data-sys="สองภาษา">#สองภาษา</span>
      </div>
    </section>

    <section id="results" class="list" aria-live="polite"></section>

    <footer>
      <p>หมายเหตุ: เวลาเดินทางเป็นค่าประมาณจาก Google Maps โดยใช้จุดอ้างอิงทั่วไปในย่านพุทธมณฑลสาย 2 (ไม่ระบุตำแหน่งบ้าน) — ตัวเลขช่วงเร่งด่วน 08:00 และ 15:00 ใส่ค่าเผื่อเพื่อประกอบการตัดสินใจเบื้องต้น</p>
    </footer>
  </div>

<script>
// ---- จัดเก็บโลโก้ใน LocalStorage ตามชื่อโรงเรียน ----
const logoStoreKey = 'school-logos-v1';
const getLogos = () => JSON.parse(localStorage.getItem(logoStoreKey) || '{}');
const setLogos = obj => localStorage.setItem(logoStoreKey, JSON.stringify(obj));

// ---- ข้อมูลโรงเรียน (ตัดข้อมูลส่วนบุคคลออก; map ลิงก์เป็นการค้นหาชื่อโรงเรียน) ----
const SCHOOLS = [
  { name: "โรงเรียนจิตตเมตต์ (Jittamett) — ทางเลือก", type:"ทางเลือก", system:"ทางเลือก", distance_km:6.9, time_normal_min:12, time_peak8_min:20, time_peak15_min:16, tuition:"≈ 158,540 บาท/ปี (2 เทอม)", curriculum:"การเรียนรวมต่างวัย เน้น EF, Orff Schulwerk, Free Day", mapQuery:"Jittamett Kindergarten", pros:["บรรยากาศการเรียนยืดหยุ่น เน้นทักษะชีวิตและ EF","เด็กต่างวัยเรียนร่วม—พัฒนาสังคม","งานดนตรี/การเคลื่อนไหวเด่น"], cons:["ไม่ใช่หลักสูตรนานาชาติ—ต้องเตรียมสะพานวิชาเมื่อย้าย","การประเมินเชิงวิชาการอาจไม่เข้มเท่าโรงเรียนสากล"] },
  { name: "Kidz Village International Kindergarten", type:"นานาชาติปฐมวัย", system:"อังกฤษ", distance_km:4.9, time_normal_min:9, time_peak8_min:16, time_peak15_min:14, tuition:"FS1 ≈ 257,100฿/ปี • FS2 ≈ 380,280฿/ปี • Y1–Y2 ≈ 394,080–417,150฿/ปี", curriculum:"EYFS (อังกฤษ), Play-based", mapQuery:"Kidz Village International Kindergarten", pros:["ใกล้ เดินทางสั้น","กิจกรรมสร้างสรรค์สำหรับปฐมวัย"], cons:["เปิดถึง Y2—ต้องย้ายตอนเข้าประถม","ค่าใช้จ่ายเสริมอาจเพิ่ม"] },
  { name: "International Pioneers School (IPS)", type:"นานาชาติ", system:"อังกฤษ", distance_km:19.7, time_normal_min:24, time_peak8_min:45, time_peak15_min:38, tuition:"ประถม ≤ 200,000฿/ปี (ประมาณ)", curriculum:"Cambridge/Edexcel (UK), WASC", mapQuery:"International Pioneers School Bangkok", pros:["ค่าเทอมย่อมเยา","เปิดถึง Y13 ต่อเนื่อง"], cons:["ระยะทางไกลกว่า","สิ่งอำนวยความสะดวกบางส่วนอาจไม่หรู"] },
  { name: "SISB Thonburi (Singapore International School of Bangkok)", type:"นานาชาติ", system:"สิงคโปร์", distance_km:8.6, time_normal_min:16, time_peak8_min:26, time_peak15_min:22, tuition:"~400,000–600,000฿/ปี", curriculum:"อนุบาล EYFS, ประถมสิงคโปร์, มัธยม IGCSE/A-Level", mapQuery:"SISB Thonburi", pros:["เด่นคณิต/วิทย์","สอน 3 ภาษา"], cons:["แข่งขันสูง","ค่าใช้จ่ายรวมกิจกรรมอาจเพิ่ม"] },
  { name: "โรงเรียนเพลินพัฒนา — ทางเลือก", type:"ทางเลือก", system:"ทางเลือก", distance_km:3.9, time_normal_min:8, time_peak8_min:14, time_peak15_min:12, tuition:"≈ 185,000–195,000฿/ปี", curriculum:"Active Learning, โครงงาน, พัฒนา EF", mapQuery:"Plearnpattana School", pros:["ใกล้มาก","วัฒนธรรมการเรียนรู้เป็นมิตร"], cons:["การโอนไปหลักสูตรสากลต้องเตรียม","ที่นั่งเต็มเร็ว"] },
  { name: "โรงเรียนอำนวยศิลป์ (Amnuay Silpa) — สองภาษา", type:"สองภาษา", system:"สองภาษา", distance_km:20.5, time_normal_min:31, time_peak8_min:55, time_peak15_min:48, tuition:"≈ 400,000฿/ปี (ประมาณ)", curriculum:"ผสมหลักสูตรไทยกับแนวสมัยใหม่ เน้นภาษาอังกฤษ", mapQuery:"Amnuay Silpa School", pros:["เครือข่ายศิษย์เก่าใหญ่","เหมาะครอบครัวที่อยากคงแกนไทย"], cons:["ไกลกว่าหลายตัวเลือก","แข่งขันสูง/ที่นั่งจำกัด"] },
  { name: "Shrewsbury International School Bangkok — Riverside", type:"นานาชาติ", system:"อังกฤษ", distance_km:21.8, time_normal_min:36, time_peak8_min:65, time_peak15_min:55, tuition:"FS1 ≈ 591,000฿/ปี • Y2 ≈ 720,300฿/ปี • Y12–13 ≈ 1,066,800฿/ปี", curriculum:"English National Curriculum → IGCSE/A-Level", mapQuery:"Shrewsbury International School Bangkok Riverside", pros:["ชื่อเสียงและผลสัมฤทธิ์สูง","ทำเลริมเจ้าพระยา กิจกรรมเด่น"], cons:["ไกลและใช้เวลาช่วงเร่งด่วนสูง","ค่าใช้จ่ายสูง"] },
  { name: "BASIS International School Bangkok", type:"นานาชาติ", system:"อเมริกัน", distance_km:20.6, time_normal_min:25, time_peak8_min:42, time_peak15_min:36, tuition:"ปฐมวัย ~520,000฿/ปี; Pre-K–Kinder ~605,000฿/ปี", curriculum:"American (BASIS Curriculum)", mapQuery:"BASIS International School Bangkok", pros:["วิชาการเข้ม โดยเฉพาะวิทย์-คณิต","ต่อเนื่องถึงเกรดสูง"], cons:["แรงกดดันด้านการบ้าน/การสอบมากกว่า","ค่าใช้จ่ายสูง"] },
  { name: "Kensington International School / Kindergarten", type:"นานาชาติปฐมวัย+ประถมต้น", system:"อังกฤษ", distance_km:10.5, time_normal_min:15, time_peak8_min:26, time_peak15_min:21, tuition:"ค่าแรกเข้าประมาณ 100,000฿; Reception ~465,000–562,500฿/ปี (โปรดยืนยัน)", curriculum:"EYFS (อังกฤษ), Play-based → Primary อังกฤษ", mapQuery:"Kensington International Kindergarten", pros:["ทำเลใกล้ สิ่งแวดล้อมเป็นมิตร","Play-based ชัดเจน"], cons:["ข้อมูลค่าเทอมอาจเปลี่ยนแปลง","ที่นั่งนิยมสูง"] },
  { name: "DBS — Denla British School", type:"นานาชาติ", system:"อังกฤษ", distance_km:25.2, time_normal_min:29, time_peak8_min:52, time_peak15_min:45, tuition:"FS1 514,000฿/ปี; KG1 650,620฿; Y1–Y5 ≈ 774,430฿; Y6–Y8 852,540฿; Y9–Y11 907,980฿; Y12–13 968,050฿", curriculum:"British independent school → IGCSE/A-Level", mapQuery:"DBS Denla British School", pros:["สิ่งอำนวยความสะดวกครบ","เส้นทางสู่ IGCSE/A-Level"], cons:["ไกลกว่าโซนใกล้บ้าน","ค่าใช้จ่ายระดับพรีเมียม"] },
];

const fmtMin = m => `${m} นาที`;
const fmtKm = km => `${km.toFixed(1)} กม.`;
const initials = name => name.replace(/\([^)]*\)/g,'').trim().split(/\s+/).map(w=>w[0]).slice(0,3).join('').toUpperCase();

function card(s){
  const logos = getLogos();
  const dataUrl = logos[s.name] || '';
  const logoEl = dataUrl ? `<img alt="โลโก้ ${s.name}" src="${dataUrl}">` : `<div class="initial">${initials(s.name)}</div>`;
  const mapUrl = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(s.mapQuery)}`;
  const id = btoa(encodeURIComponent(s.name));
  return `
  <article class=\"panel card\" data-name=\"${s.name}\" data-system=\"${s.system}\" data-type=\"${s.type}\" data-distance=\"${s.distance_km}\" data-normal=\"${s.time_normal_min}\" data-peak8=\"${s.time_peak8_min}\" data-peak15=\"${s.time_peak15_min}\">\n    <div class=\"title\">\n      <div class=\"logo\" id=\"logo-${id}\">${logoEl}</div>\n      <div>${s.name}</div>\n      <div class=\"logoBar\">\n        <button class=\"pill ghost\" data-act=\"upload\" data-id=\"${id}\">เพิ่มโลโก้</button>\n        <button class=\"pill\" data-act=\"map\" data-href=\"${mapUrl}\">แผนที่</button>\n      </div>\n    </div>\n    <div class=\"meta\">\n      <span class=\"pill\">ระยะทาง: ${fmtKm(s.distance_km)}</span>\n      <span class=\"pill\">ปกติ: ${fmtMin(s.time_normal_min)}</span>\n      <span class=\"pill warn\">08:00: ${fmtMin(s.time_peak8_min)}</span>\n      <span class=\"pill warn\">15:00: ${fmtMin(s.time_peak15_min)}</span>\n    </div>\n    <div class=\"badges\">\n      <span class=\"badge\">ระบบ: ${s.system}</span>\n      <span class=\"badge\">หมวด: ${s.type}</span>\n    </div>\n    <div>หลักสูตร: ${s.curriculum}</div>\n    <div>ค่าเทอม: ${s.tuition}</div>\n    <div class=\"proscons\">\n      <div>\n        <div class=\"soft\">ข้อดี</div>\n        <ul>${s.pros.map(x=>`<li>${x}</li>`).join('')}</ul>\n      </div>\n      <div>\n        <div class=\"soft\">ข้อเสีย</div>\n        <ul>${s.cons.map(x=>`<li>${x}</li>`).join('')}</ul>\n      </div>\n    </div>\n  </article>`;
}

function render(){
  const q = document.querySelector('#q').value.trim().toLowerCase();
  const sys = document.querySelector('#system').value;
  const maxKm = +document.querySelector('#maxKm').value;
  const sortBy = document.querySelector('#sort').value;

  let out = SCHOOLS.filter(s => {
    const hitQ = !q || [s.name,s.type,s.system,s.tuition,s.curriculum].join(' ').toLowerCase().includes(q);
    const hitSys = !sys || s.system === sys;
    const hitKm = s.distance_km <= maxKm;
    return hitQ && hitSys && hitKm;
  });

  out.sort((a,b)=>{
    if(sortBy==='name') return a.name.localeCompare(b.name,'th');
    if(sortBy==='distance') return a.distance_km - b.distance_km;
    if(sortBy==='normal') return a.time_normal_min - b.time_normal_min;
    if(sortBy==='peak8') return a.time_peak8_min - b.time_peak8_min;
    if(sortBy==='peak15') return a.time_peak15_min - b.time_peak15_min;
    return 0;
  });

  document.querySelector('#results').innerHTML = out.map(card).join('');

  // bind actions for logos & map buttons
  document.querySelectorAll('[data-act="upload"]').forEach(btn=>{
    btn.onclick = async ()=>{
      const name = decodeURIComponent(atob(btn.dataset.id));
      const input = Object.assign(document.createElement('input'),{type:'file',accept:'image/*'});
      input.onchange = ()=>{
        const file = input.files[0]; if(!file) return;
        const reader = new FileReader();
        reader.onload = ()=>{
          const logos = getLogos(); logos[name] = reader.result; setLogos(logos); render();
        };
        reader.readAsDataURL(file);
      };
      input.click();
    };
  });
  document.querySelectorAll('[data-act="map"]').forEach(btn=>{
    btn.onclick = ()=> window.open(btn.dataset.href,'_blank');
  });
}

['q','system','sort','maxKm'].forEach(id=>{
  document.getElementById(id).addEventListener('input', ()=>{
    if(id==='maxKm') document.getElementById('maxKmVal').textContent = `≤ ${document.getElementById('maxKm').value} กม.`;
    render();
  });
});

document.getElementById('btnReset').addEventListener('click',()=>{
  document.getElementById('q').value='';
  document.getElementById('system').value='';
  document.getElementById('sort').value='name';
  document.getElementById('maxKm').value=35;document.getElementById('maxKmVal').textContent='≤ 35 กม.';
  // เคลียร์โลโก้ด้วย (ถามผู้ใช้)
  if(confirm('ต้องการลบโลโก้ทั้งหมดที่บันทึกไว้หรือไม่?')) setLogos({});
  render();
});

// quick system chips
Array.from(document.getElementById('quick').querySelectorAll('.chip')).forEach(el=>{
  el.addEventListener('click',()=>{
    document.getElementById('system').value = el.dataset.sys;
    render();
  })
});

// ส่งออก CSV
function toCSV(rows){
  const escape = v => '"'+String(v).replaceAll('"','""')+'"';
  const header = ['โรงเรียน','ระบบ','หมวด','ระยะทาง(กม.)','ปกติ(นาที)','08:00(นาที)','15:00(นาที)','หลักสูตร','ค่าเทอม'];
  const body = rows.map(s=>[s.name,s.system,s.type,s.distance_km,s.time_normal_min,s.time_peak8_min,s.time_peak15_min,s.curriculum,s.tuition].map(escape).join(','));
  return [header.map(escape).join(','),...body].join('\n');
}

document.getElementById('btnExport').addEventListener('click',()=>{
  const blob = new Blob([toCSV(SCHOOLS)],{type:'text/csv;charset=utf-8'});
  const url = URL.createObjectURL(blob);
  const a = Object.assign(document.createElement('a'),{href:url,download:'schools-comparison-zone-pmsa2.csv'});
  document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
});

render();
</script>
</body>
</html>
